<!-- image -->

www.ti.com

## 15.2.3 Use Cases

An ePWM module has all the local resources necessary to operate completely as a standalone module or to operate in synchronization with other identical ePWM modules.

## 15.2.3.1 Overview of Multiple Modules

Previously in this user's guide, all discussions have described the operation of a single module. To facilitate the understanding of multiple modules working together in a system, the ePWM module described in reference is represented by the more simplified block diagram shown in Figure 15-55. This simplified ePWM block shows only the key resources needed to explain how a multiswitch power topology is controlled with multiple ePWM modules working together.

Figure 15-55. Simplified ePWM Module

<!-- image -->

## 15.2.3.2 Key Configuration Capabilities

The key configuration choices available to each module are as follows:

- Options for SyncIn
- -Load own counter with phase register on an incoming sync strobe-enable (EN) switch closed
- -Do nothing or ignore incoming sync strobe-enable switch open
- -Sync flow-through - SyncOut connected to SyncIn
- -Master mode, provides a sync at PWM boundaries-SyncOut connected to CTR = PRD
- -Master mode, provides a sync at any programmable point in time-SyncOut connected to CTR = CMPB
- -Module is in standalone mode and provides No sync to other modules-SyncOut connected to X (disabled)
- Options for SyncOut
- -Sync flow-through - SyncOut connected to SyncIn
- -Master mode, provides a sync at PWM boundaries-SyncOut connected to CTR = PRD
- -Master mode, provides a sync at any programmable point in time-SyncOut connected to CTR = CMPB
- -Module is in standalone mode and provides No sync to other modules-SyncOut connected to X (disabled)

For each choice of SyncOut, a module may also choose to load its own counter with a new phase value on a SyncIn strobe input or choose to ignore it, i.e., via the enable switch. Although various combinations are possible, the two most common-master module and slave module modes-are shown in Figure 1556.

Figure 15-56. EPWM1 Configured as a Typical Master, EPWM2 Configured as a Slave

<!-- image -->

<!-- image -->

<!-- image -->

<!-- image -->

www.ti.com

## 15.2.3.3 Controlling Multiple Buck Converters With Independent Frequencies

One of the simplest power converter topologies is the buck. A single ePWM module configured as a master can control two buck stages with the same PWM frequency. If independent frequency control is required for each buck converter, then one ePWM module must be allocated for each converter stage. Figure 15-57 shows four buck stages, each running at independent frequencies. In this case, all four ePWM modules are configured as Masters and no synchronization is used. Figure 15-58 shows the waveforms generated by the setup shown in Figure 15-57; note that only three waveforms are shown, although there are four stages.

Figure 15-57. Control of Four Buck Stages. Here FPWM1 ≠ FPWM2 ≠ FPWM3 ≠ FPWM4

<!-- image -->

NOTE: Θ = X indicates value in phase register is a "don't care"

Figure 15-58. Buck Waveforms for Figure 15-57 (Note: Only three bucks shown here)

<!-- image -->

P

I

<!-- image -->

Indicates this event triggers an interrupt

<!-- image -->

www.ti.com

Table 15-48. EPWM1 Initialization for Figure 15-58

| Register   | Bit       | Value           | Comments                   |
|------------|-----------|-----------------|----------------------------|
| TBPRD      | TBPRD     | 1200 (4B0h)     | Period = 1201 TBCLK counts |
| TBPHS      | TBPHS     | 0               | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UP           |                            |
|            | PHSEN     | TB_DISABLE      | Phase loading disabled     |
|            | PRDLD     | TB_SHADOW       |                            |
|            | SYNCOSEL  | TB_SYNC_DISABLE |                            |
| CMPCTL     | SHDWAMODE | CC_SHADOW       |                            |
|            | SHDWBMODE | CC_SHADOW       |                            |
|            | LOADAMODE | CC_CTR_ZERO     | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO     | Load on CTR = 0            |
| AQCTLA     | PRD       | AQ_CLEAR        |                            |
|            | CAU       | AQ_SET          |                            |

Table 15-49. EPWM2 Initialization for Figure 15-58

| Register   | Bit       | Value           | Comments                   |
|------------|-----------|-----------------|----------------------------|
| TBPRD      | TBPRD     | 1400 (578h)     | Period = 1401 TBCLK counts |
| TBPHS      | TBPHS     | 0               | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UP           |                            |
|            | PHSEN     | TB_DISABLE      | Phase loading disabled     |
|            | PRDLD     | TB_SHADOW       |                            |
|            | SYNCOSEL  | TB_SYNC_DISABLE |                            |
| CMPCTL     | SHDWAMODE | CC_SHADOW       |                            |
|            | SHDWBMODE | CC_SHADOW       |                            |
|            | LOADAMODE | CC_CTR_ZERO     | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO     | Load on CTR = 0            |
| AQCTLA     | PRD       | AQ_CLEAR        |                            |
|            | CAU       | AQ_SET          |                            |

Table 15-50. EPWM3 Initialization for Figure 15-58

| Register   | Bit       | Value           | Comments                  |
|------------|-----------|-----------------|---------------------------|
| TBPRD      | TBPRD     | 800 (320h)      | Period = 801 TBCLK counts |
| TBPHS      | TBPHS     | 0               | Clear Phase Register to 0 |
| TBCTL      | CTRMODE   | TB_UP           |                           |
|            | PHSEN     | TB_DISABLE      | Phase loading disabled    |
|            | PRDLD     | TB_SHADOW       |                           |
|            | SYNCOSEL  | TB_SYNC_DISABLE |                           |
| CMPCTL     | SHDWAMODE | CC_SHADOW       |                           |
|            | SHDWBMODE | CC_SHADOW       |                           |
|            | LOADAMODE | CC_CTR_ZERO     | Load on CTR = 0           |
|            | LOADBMODE | CC_CTR_ZERO     | Load on CTR = 0           |
| AQCTLA     | PRD       | AQ_CLEAR        |                           |
|            | CAU       | AQ_SET          |                           |

## Example 15-12. Configuration for Example in Figure 15-58

```
// Run Time (Note: Example execution of one run-time instance) //========================================================= EPwm1Regs.CMPA.half.CMPA = 700; // adjust duty for output EPWM1A EPwm2Regs.CMPA.half.CMPA = 700; // adjust duty for output EPWM2A EPwm3Regs.CMPA.half.CMPA = 500; // adjust duty for output EPWM3A
```

## 15.2.3.4 Controlling Multiple Buck Converters With Same Frequencies

If synchronization is a requirement, ePWM module 2 can be configured as a slave and can operate at integer multiple (N) frequencies of module 1. The sync signal from master to slave ensures these modules remain locked. Figure 15-59 shows such a configuration; Figure 15-60 shows the waveforms generated by the configuration.

<!-- image -->

<!-- image -->

<!-- image -->

www.ti.com

<!-- image -->

Table 15-51. EPWM1 Initialization for Figure 15-59

| Register   | Bit       | Value       | Comments                   |
|------------|-----------|-------------|----------------------------|
| TBPRD      | TBPRD     | 600 (258h)  | Period = 1200 TBCLK counts |
| TBPHS      | TBPHS     | 0           | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UPDOWN   |                            |
|            | PHSEN     | TB_DISABLE  | Phase loading disabled     |
|            | PRDLD     | TB_SHADOW   |                            |
|            | SYNCOSEL  | TB_CTR_ZERO | Sync down-stream module    |
| CMPCTL     | SHDWAMODE | CC_SHADOW   |                            |
|            | SHDWBMODE | CC_SHADOW   |                            |
|            | LOADAMODE | CC_CTR_ZERO | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO | Load on CTR = 0            |
| AQCTLA     | CAU       | AQ_SET      | Set actions for EPWM1A     |
|            | CAD       | AQ_CLEAR    |                            |
| AQCTLB     | CBU       | AQ_SET      | Set actions for EPWM1B     |
|            | CBD       | AQ_CLEAR    |                            |

Table 15-52. EPWM2 Initialization for Figure 15-59

| Register   | Bit       | Value       | Comments                   |
|------------|-----------|-------------|----------------------------|
| TBPRD      | TBPRD     | 600 (258h)  | Period = 1200 TBCLK counts |
| TBPHS      | TBPHS     | 0           | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UPDOWN   |                            |
|            | PHSEN     | TB_ENABLE   | Phase loading enabled      |
|            | PRDLD     | TB_SHADOW   |                            |
|            | SYNCOSEL  | TB_SYNC_IN  | Sync flow-through          |
| CMPCTL     | SHDWAMODE | CC_SHADOW   |                            |
|            | SHDWBMODE | CC_SHADOW   |                            |
|            | LOADAMODE | CC_CTR_ZERO | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO | Load on CTR = 0            |
| AQCTLA     | CAU       | AQ_SET      | Set actions for EPWM2A     |
|            | CAD       | AQ_CLEAR    |                            |
| AQCTLB     | CBU       | AQ_SET      | Set actions for EPWM2B     |
|            | CBD       | AQ_CLEAR    |                            |

## Example 15-13. Code Snippet for Configuration in Figure 15-59

```
// Run Time (Note: Example execution of one run-time instance) //=========================================================== EPwm1Regs.CMPA.half.CMPA = 400; // adjust duty for output EPWM1A EPwm1Regs.CMPB = 200; // adjust duty for output EPWM1B EPwm2Regs.CMPA.half.CMPA = 500; // adjust duty for output EPWM2A EPwm2Regs.CMPB = 300; // adjust duty for output EPWM2B
```

<!-- image -->

<!-- image -->

## 15.2.3.5 Controlling Multiple Half H-Bridge (HHB) Converters

Topologies that require control of multiple switching elements can also be addressed with these same ePWM modules. It is possible to control a Half-H bridge stage with a single ePWM module. This control can be extended to multiple stages. Figure 15-61 shows control of two synchronized Half-H bridge stages where stage 2 can operate at integer multiple (N) frequencies of stage 1. Figure 15-62 shows the waveforms generated by the configuration shown in Figure 15-61.

Module 2 (slave) is configured for Sync flow-through; if required, this configuration allows for a third Half-H bridge to be controlled by PWM module 3 and also, most importantly, to remain in synchronization with master module 1.

Figure 15-61. Control of Two Half-H Bridge Stages (F PWM2 = N × F PWM1 )

<!-- image -->

<!-- image -->

Figure 15-62. Half-H Bridge Waveforms for Figure 15-61 (Note: Here F PWM2 = FPWM1 )

<!-- image -->

<!-- image -->

www.ti.com

## Table 15-53. EPWM1 Initialization for Figure 15-61

| Register   | Bit       | Value       | Comments                   |
|------------|-----------|-------------|----------------------------|
| TBPRD      | TBPRD     | 600 (258h)  | Period = 1200 TBCLK counts |
| TBPHS      | TBPHS     | 0           | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UPDOWN   |                            |
|            | PHSEN     | TB_DISABLE  | Phase loading disabled     |
|            | PRDLD     | TB_SHADOW   |                            |
|            | SYNCOSEL  | TB_CTR_ZERO | Sync down-stream module    |
| CMPCTL     | SHDWAMODE | CC_SHADOW   |                            |
|            | SHDWBMODE | CC_SHADOW   |                            |
|            | LOADAMODE | CC_CTR_ZERO | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO | Load on CTR = 0            |
| AQCTLA     | ZRO       | AQ_SET      | Set actions for EPWM1A     |
|            | CAU       | AQ_CLEAR    |                            |
| AQCTLB     | ZRO       | AQ_CLEAR    | Set actions for EPWM1B     |
|            | CAD       | AQ_SET      |                            |

Table 15-54. EPWM2 Initialization for Figure 15-61

| Register   | Bit       | Value       | Comments                   |
|------------|-----------|-------------|----------------------------|
| TBPRD      | TBPRD     | 600 (258h)  | Period = 1200 TBCLK counts |
| TBPHS      | TBPHS     | 0           | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UPDOWN   |                            |
|            | PHSEN     | TB_ENABLE   | Phase loading enabled      |
|            | PRDLD     | TB_SHADOW   |                            |
|            | SYNCOSEL  | TB_SYNC_IN  | Sync flow-through          |
| CMPCTL     | SHDWAMODE | CC_SHADOW   |                            |
|            | SHDWBMODE | CC_SHADOW   |                            |
|            | LOADAMODE | CC_CTR_ZERO | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO | Load on CTR = 0            |
| AQCTLA     | ZRO       | AQ_SET      | Set actions for EPWM2A     |
|            | CAU       | AQ_CLEAR    |                            |
| AQCTLB     | ZRO       | AQ_CLEAR    | Set actions for EPWM2B     |
|            | CAD       | AQ_SET      |                            |

## Example 15-14. Code Snippet for Configuration in Figure 15-61

```
// Run Time (Note: Example execution of one run-time instance) //=========================================================== EPwm1Regs.CMPA.half.CMPA = 400; // adjust duty for output EPWM1A EPwm1Regs.CMPB = 200; // adjust duty for output EPWM1B EPwm2Regs.CMPA.half.CMPA = 500; // adjust duty for output EPWM2A EPwm2Regs.CMPB = 250; // adjust duty for output EPWM2B
```

## 15.2.3.6 Controlling Dual 3-Phase Inverters for Motors (ACI and PMSM)

The idea of multiple modules controlling a single power stage can be extended to the 3-phase Inverter case. In such a case, six switching elements can be controlled using three PWM modules, one for each leg of the inverter. Each leg must switch at the same frequency and all legs must be synchronized. A master + two slaves configuration can easily address this requirement. Figure 15-63 shows how six PWM modules can control two independent 3-phase Inverters; each running a motor.

As in the cases shown in the previous sections, we have a choice of running each inverter at a different frequency (module 1 and module 4 are masters as in Figure 15-63), or both inverters can be synchronized by using one master (module 1) and five slaves. In this case, the frequency of modules 4, 5, and 6 (all equal) can be integer multiples of the frequency for modules 1, 2, 3 (also all equal).

Figure 15-63. Control of Dual 3-Phase Inverter Stages as Is Commonly Used in Motor Control

<!-- image -->

<!-- image -->

<!-- image -->

www.ti.com

## Figure 15-64. 3-Phase Inverter Waveforms for Figure 15-63 (Only One Inverter Shown)

<!-- image -->

Table 15-55. EPWM1 Initialization for Figure 15-63

| Register   | Bit                           | Value                                       | Comments                                        |
|------------|-------------------------------|---------------------------------------------|-------------------------------------------------|
| TBPRD      | TBPRD                         | 800 (320h)                                  | Period = 1600 TBCLK counts                      |
| TBPHS      | TBPHS                         | 0                                           | Clear Phase Register to 0                       |
| TBCTL      | CTRMODE PHSEN PRDLD SYNCOSEL  | TB_UPDOWN TB_DISABLE TB_SHADOW TB_CTR_ZERO  | Phase loading disabled Sync down-stream module  |
| CMPCTL     | SHDWAMODE SHDWBMODE LOADAMODE | CC_SHADOW CC_SHADOW CC_CTR_ZERO CC_CTR_ZERO | Load on CTR = 0 Load on CTR = 0                 |
| AQCTLA     | LOADBMODE CAU CAD             | AQ_SET AQ_CLEAR                             | Set actions for EPWM1A                          |
| DBCTL      | MODE POLSEL                   | DB_FULL_ENABLE DB_ACTV_HIC                  | Enable Dead-band module Active Hi complementary |
| DBFED      | DBFED                         | 50                                          | FED = 50 TBCLKs                                 |
|            | DBRED                         | 50                                          | RED = 50 TBCLKs                                 |

Table 15-56. EPWM2 Initialization for Figure 15-63

| Register   | Bit       | Value          | Comments                   |
|------------|-----------|----------------|----------------------------|
| TBPRD      | TBPRD     | 800 (320h)     | Period = 1600 TBCLK counts |
| TBPHS      | TBPHS     | 0              | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UPDOWN      |                            |
|            | PHSEN     | TB_ENABLE      | Slave module               |
|            | PRDLD     | TB_SHADOW      |                            |
|            | SYNCOSEL  | TB_SYNC_IN     | Sync flow-through          |
| CMPCTL     | SHDWAMODE | CC_SHADOW      |                            |
|            | SHDWBMODE | CC_SHADOW      |                            |
|            | LOADAMODE | CC_CTR_ZERO    | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO    | Load on CTR = 0            |
| AQCTLA     | CAU       | AQ_SET         | Set actions for EPWM2A     |
|            | CAD       | AQ_CLEAR       |                            |
| DBCTL      | MODE      | DB_FULL_ENABLE | Enable Dead-band module    |
|            | POLSEL    | DB_ACTV_HIC    | Active Hi complementary    |
| DBFED      | DBFED     | 50             | FED = 50 TBCLKs            |
|            | DBRED     | 50             | RED = 50 TBCLKs            |

<!-- image -->

<!-- image -->

www.ti.com

## Table 15-57. EPWM3 Initialization for Figure 15-63

| Register   | Bit           | Value                         | Comments                   |
|------------|---------------|-------------------------------|----------------------------|
| TBPRD      | TBPRD         | 800 (320h)                    | Period = 1600 TBCLK counts |
| TBPHS      | TBPHS         | 0                             | Clear Phase Register to 0  |
| TBCTL      | CTRMODE PHSEN | TB_UPDOWN TB_ENABLE TB_SHADOW |                            |
|            |               |                               | Slave module               |
|            | PRDLD         |                               |                            |
|            | SYNCOSEL      | TB_SYNC_IN                    | Sync flow-through          |
| CMPCTL     | SHDWAMODE     | CC_SHADOW                     |                            |
|            | SHDWBMODE     | CC_SHADOW                     |                            |
|            | LOADAMODE     | CC_CTR_ZERO                   | Load on CTR = 0            |
|            | LOADBMODE     | CC_CTR_ZERO                   | Load on CTR = 0            |
| AQCTLA     | CAU           | AQ_SET                        | Set actions for EPWM3A     |
|            | CAD           | AQ_CLEAR                      |                            |
| DBCTL      | MODE          | DB_FULL_ENABLE                | Enable Dead-band module    |
|            | POLSEL        | DB_ACTV_HIC                   | Active Hi complementary    |
| DBFED      | DBFED         | 50                            | FED = 50 TBCLKs            |
|            | DBRED         | 50                            | RED = 50 TBCLKs            |

## Example 15-15. Code Snippet for Configuration in Figure 15-63

```
// Run Time (Note: Example execution of one run-time instance) //=========================================================
```

EPwm1Regs.CMPA.half.CMPA = 500; // adjust duty for output EPWM1A

EPwm2Regs.CMPA.half.CMPA = 600; // adjust duty for output EPWM2A

EPwm3Regs.CMPA.half.CMPA = 700; // adjust duty for output EPWM3A

## 15.2.3.7 Practical Applications Using Phase Control Between PWM Modules

So far, none of the examples have made use of the phase register (TBPHS). It has either been set to zero or its value has been a don't care. However, by programming appropriate values into TBPHS, multiple PWM modules can address another class of power topologies that rely on phase relationship between legs (or stages) for correct operation. As described in the TB module section, a PWM module can be configured to allow a SyncIn pulse to cause the TBPHS register to be loaded into the TBCNT register. To illustrate this concept, Figure 15-65 shows a master and slave module with a phase relationship of 120°, that is, the slave leads the master.

Figure 15-65. Configuring Two PWM Modules for Phase Control

<!-- image -->

Figure 15-66 shows the associated timing waveforms for this configuration. Here, TBPRD = 600 for both master and slave. For the slave, TBPHS = 200 (200/600 × 360° = 120°). Whenever the master generates a SyncIn pulse (CTR = PRD), the value of TBPHS = 200 is loaded into the slave TBCNT register so the slave time-base is always leading the master's time-base by 120°.

<!-- image -->

<!-- image -->

www.ti.com

Figure 15-66. Timing Waveforms Associated With Phase Control Between 2 Modules

<!-- image -->

## 15.2.3.8 Controlling a 3-Phase Interleaved DC/DC Converter

A popular power topology that makes use of phase-offset between modules is shown in Figure 15-67. This system uses three PWM modules, with module 1 configured as the master. To work, the phase relationship between adjacent modules must be F = 120°. This is achieved by setting the slave TBPHS registers 2 and 3 with values of 1/3 and 2/3 of the period value, respectively. For example, if the period register is loaded with a value of 600 counts, then TBPHS (slave 2) = 200 and TBPHS (slave 3) = 400. Both slave modules are synchronized to the master 1 module.

This concept can be extended to four or more phases, by setting the TBPHS values appropriately. The following formula gives the TBPHS values for N phases:

TBPHS(N,M) = (TBPRD/N) × (M - 1)

Where:

N = number of phases

M = PWM module number

For example, for the 3-phase case (N = 3), TBPRD = 600,

TBPHS(3,2) = (600/3) × (2 - 1) = 200 × 1 = 200 (Phase value for Slave module 2)

TBPHS(3,3) = (600/3) × (3 - 1) = 200 × 2 = 400 (Phase value for Slave module 3)

Figure 15-68 shows the waveforms for the configuration in Figure 15-67.

<!-- image -->

Figure 15-67. Control of a 3-Phase Interleaved DC/DC Converter

<!-- image -->

<!-- image -->

www.ti.com

Figure 15-68. 3-Phase Interleaved DC/DC Converter Waveforms for Figure 15-67

<!-- image -->

Table 15-58. EPWM1 Initialization for Figure 15-67

| Register   | Bit                           | Value                                       | Comments                                        |
|------------|-------------------------------|---------------------------------------------|-------------------------------------------------|
| TBPRD      | TBPRD                         | 450 (1C2h)                                  | Period = 900 TBCLK counts                       |
| TBPHS      | TBPHS                         | 0                                           | Clear Phase Register to 0                       |
| TBCTL      | CTRMODE PHSEN PRDLD SYNCOSEL  | TB_UPDOWN TB_DISABLE TB_SHADOW TB_CTR_ZERO  | Phase loading disabled Sync down-stream module  |
| CMPCTL     | SHDWAMODE SHDWBMODE LOADAMODE | CC_SHADOW CC_SHADOW CC_CTR_ZERO CC_CTR_ZERO | Load on CTR = 0 Load on CTR = 0                 |
| AQCTLA     | LOADBMODE CAU CAD             | AQ_SET AQ_CLEAR                             | Set actions for EPWM1A                          |
| DBCTL      | MODE POLSEL                   | DB_FULL_ENABLE DB_ACTV_HIC                  | Enable Dead-band module Active Hi complementary |
| DBFED      | DBFED                         | 20                                          | FED = 20 TBCLKs                                 |
|            | DBRED                         | 20                                          | RED = 20 TBCLKs                                 |

Table 15-59. EPWM2 Initialization for Figure 15-67

| Register   | Bit           | Value               | Comments                       |
|------------|---------------|---------------------|--------------------------------|
| TBPRD      | TBPRD         | 450 (1C2h)          | Period = 900 TBCLK counts      |
| TBPHS      | TBPHS         | 300                 | Phase = (300/900) × 360 = 120° |
| TBCTL      | CTRMODE PHSEN | TB_UPDOWN TB_ENABLE |                                |
|            |               |                     | Slave module                   |
|            | PRDLD         | TB_SHADOW           |                                |
|            | SYNCOSEL      | TB_SYNC_IN          | Sync flow-through              |
|            | PHSDIR        | TB_DOWN             | Count DOWN on sync             |
| CMPCTL     | SHDWAMODE     | CC_SHADOW           |                                |
|            | SHDWBMODE     | CC_SHADOW           |                                |
|            | LOADAMODE     | CC_CTR_ZERO         | Load on CTR = 0                |
|            | LOADBMODE     | CC_CTR_ZERO         | Load on CTR = 0                |
| AQCTLA     | CAU           | AQ_SET              | Set actions for EPWM2A         |
|            | CAD           | AQ_CLEAR            |                                |
| DBCTL      | MODE          | DB_FULL_ENABLE      | Enable Dead-band module        |
|            | POLSEL        | DB_ACTV_HIC         | Active Hi complementary        |
| DBFED      | DBFED         | 20                  | FED = 20 TBCLKs                |
|            | DBRED         | 20                  | RED = 20 TBCLKs                |

<!-- image -->

<!-- image -->

www.ti.com

## Table 15-60. EPWM3 Initialization for Figure 15-67

| Register   | Bit       | Value               | Comments                       |
|------------|-----------|---------------------|--------------------------------|
| TBPRD      | TBPRD     | 450 (1C2h)          | Period = 900 TBCLK counts      |
| TBPHS      | TBPHS     | 300                 | Phase = (300/900) × 360 = 120° |
| TBCTL      | CTRMODE   | TB_UPDOWN TB_ENABLE |                                |
|            | PHSEN     |                     | Slave module                   |
|            | PRDLD     | TB_SHADOW           |                                |
|            | SYNCOSEL  | TB_SYNC_IN          | Sync flow-through              |
|            | PHSDIR    | TB_UP               | Count UP on sync               |
| CMPCTL     | SHDWAMODE | CC_SHADOW           |                                |
|            | SHDWBMODE | CC_SHADOW           |                                |
|            | LOADAMODE | CC_CTR_ZERO         | Load on CTR = 0                |
|            | LOADBMODE | CC_CTR_ZERO         | Load on CTR = 0                |
| AQCTLA     | CAU       | AQ_SET              | Set actions for EPWM3A         |
|            | CAD       | AQ_CLEAR            |                                |
| DBCTL      | MODE      | DB_FULL_ENABLE      | Enable Dead-band module        |
|            | POLSEL    | DB_ACTV_HIC         | Active Hi complementary        |
| DBFED      | DBFED     | 20                  | FED = 20 TBCLKs                |
|            | DBRED     | 20                  | RED = 20 TBCLKs                |

## Example 15-16. Code Snippet for Configuration in Figure 15-67

```
// Run Time (Note: Example execution of one run-time instance) //=========================================================== EPwm1Regs.CMPA.half.CMPA = 285; // adjust duty for output EPWM1A EPwm2Regs.CMPA.half.CMPA = 285; // adjust duty for output EPWM2A EPwm3Regs.CMPA.half.CMPA = 285; // adjust duty for output EPWM3A
```

## 15.2.3.9 Controlling Zero Voltage Switched Full Bridge (ZVSFB) Converter

The example given in Figure 15-69 assumes a static or constant phase relationship between legs (modules). In such a case, control is achieved by modulating the duty cycle. It is also possible to dynamically change the phase value on a cycle-by-cycle basis. This feature lends itself to controlling a class of power topologies known as phase-shifted full bridge , or zero voltage switched full bridge. Here the controlled parameter is not duty cycle (this is kept constant at approximately 50 percent); instead it is the phase relationship between legs. Such a system can be implemented by allocating the resources of two PWM modules to control a single power stage, which in turn requires control of four switching elements. Figure 15-70 shows a master/slave module combination synchronized together to control a full H-bridge. In this case, both master and slave modules are required to switch at the same PWM frequency. The phase is controlled by using the slave's phase register (TBPHS). The master's phase register is not used and therefore can be initialized to zero.

Figure 15-69. Controlling a Full-H Bridge Stage (F PWM2 = FPWM1)

<!-- image -->

Var = Variable

<!-- image -->

<!-- image -->

www.ti.com

## Figure 15-70. ZVS Full-H Bridge Waveforms

<!-- image -->

Table 15-61. EPWM1 Initialization for Figure 15-69

| Register   | Bit       | Value          | Comments                   |
|------------|-----------|----------------|----------------------------|
| TBPRD      | TBPRD     | 1200 (4B0h)    | Period = 1201 TBCLK counts |
| TBPHS      | TBPHS     | 0              | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UP          |                            |
|            | PHSEN     | TB_DISABLE     | Phase loading disabled     |
|            | PRDLD     | TB_SHADOW      |                            |
|            | SYNCOSEL  | TB_CTR_ZERO    | Sync down-stream module    |
| CMPA       | CMPA      | 600 (258h)     | Set 50% duty for EPWM1A    |
| CMPCTL     | SHDWAMODE | CC_SHADOW      |                            |
|            | SHDWBMODE | CC_SHADOW      |                            |
|            | LOADAMODE | CC_CTR_ZERO    | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO    | Load on CTR = 0            |
| AQCTLA     | ZRO       | AQ_SET         | Set actions for EPWM1A     |
|            | CAU       | AQ_CLEAR       |                            |
| DBCTL      | MODE      | DB_FULL_ENABLE | Enable Dead-band module    |
|            | POLSEL    | DB_ACTV_HIC    | Active Hi complementary    |
| DBFED      | DBFED     | 50             | FED = 50 TBCLKs            |
|            | DBRED     | 70             | RED = 70 TBCLKs            |

Table 15-62. EPWM2 Initialization for Figure 15-69

| Register   | Bit       | Value          | Comments                   |
|------------|-----------|----------------|----------------------------|
| TBPRD      | TBPRD     | 1200 (4B0h)    | Period = 1201 TBCLK counts |
| TBPHS      | TBPHS     | 0              | Clear Phase Register to 0  |
| TBCTL      | CTRMODE   | TB_UP          |                            |
|            | PHSEN     | TB_ENABLE      | Slave module               |
|            | PRDLD     | TB_SHADOW      |                            |
|            | SYNCOSEL  | TB_SYNC_IN     | Sync flow-through          |
| CMPA       | CMPA      | 600 (258h)     | Set 50% duty for EPWM2A    |
| CMPCTL     | SHDWAMODE | CC_SHADOW      |                            |
|            | SHDWBMODE | CC_SHADOW      |                            |
|            | LOADAMODE | CC_CTR_ZERO    | Load on CTR = 0            |
|            | LOADBMODE | CC_CTR_ZERO    | Load on CTR = 0            |
| AQCTLA     | ZRO       | AQ_SET         | Set actions for EPWM2A     |
|            | CAU       | AQ_CLEAR       |                            |
| DBCTL      | MODE      | DB_FULL_ENABLE | Enable Dead-band module    |
|            | POLSEL    | DB_ACTV_HIC    | Active Hi complementary    |
| DBFED      | DBFED     | 30             | FED = 30 TBCLKs            |
|            | DBRED     | 40             | RED = 40 TBCLKs            |

## Example 15-17. Code Snippet for Configuration in Figure 15-69

```
// Run Time (Note: Example execution of one run-time instance) //============================================================ EPwm2Regs.TBPHS = 1200-300; // Set Phase reg to 300/1200 * 360 = 90 deg EPwm1Regs.DBFED = FED1_NewValue; // Update ZVS transition interval EPwm1Regs.DBRED = RED1_NewValue; // Update ZVS transition interval EPwm2Regs.DBFED = FED2_NewValue; // Update ZVS transition interval
```

<!-- image -->